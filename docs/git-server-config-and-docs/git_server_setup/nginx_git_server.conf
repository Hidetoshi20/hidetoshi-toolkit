server {
    listen 8888; # Git 服务将运行在 8888 端口
    server_name localhost;

    # Git 仓库的根目录
    root /Users/hidetoshidekisugi/Documents/git-repos;

    # 允许大文件推送
    client_max_body_size 0;

    location ~ /git(/.*) {
        # FastCGI 参数
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME /opt/homebrew/Cellar/git/2.50.1/libexec/git-core/git-http-backend;
        fastcgi_param GIT_HTTP_EXPORT_ALL "";
        fastcgi_param GIT_PROJECT_ROOT /Users/hidetoshidekisugi/Documents/git-repos;
        fastcgi_param PATH_INFO $1;

        # 解决 "dubious ownership" 问题的关键
        # 通过环境变量注入安全目录配置，无需修改系统或仓库的 git config
        fastcgi_param GIT_CONFIG_KEY_0 safe.directory;
        fastcgi_param GIT_CONFIG_VALUE_0 /Users/hidetoshidekisugi/Documents/git-repos;
        fastcgi_pass unix:/opt/homebrew/var/run/fcgiwrap.sock;
    }
}
