# Prompt · 既有页面增加功能

> 适用：在现有页面加按钮/入口/交互，如“导出 PDF”“批量操作”“额外筛选条件”。

## 0. 任务定义 / 背景收集
```text
请把以下功能增强需求整理成 spec（轻量版）：
- 页面/模块：<名称>
- 新入口或触发方式：<描述>
- 触发后流程：<描述>
- 权限/角色限制：<描述>
- API / 数据契约：<接口 + 字段>
- 影响面：URL、全局状态、后端依赖、其他页面
输出：
1. 功能目标
2. 新增交互入口与状态（启用/禁用条件）
3. 调用流程（步骤 + 预置/后置动作）
4. 验收标准（用户行为角度）
5. 已知风险或待澄清项
```

## 1. 任务分解 / 施工计划
```text
按最小提交单元拆步骤。建议顺序：
1. UI 入口（按钮/tooltip/禁用态）
2. 副作用（thunk/mutation/service）
3. 结果反馈（toast/modal/download）
4. Edge cases（失败/权限/空状态）
每个 step 写：修改文件、复用/新增的数据结构、验收方式。禁止重写整页。
```

## 2. 上下文装载
```text
现有代码片段：
- 目标页面组件：<粘贴>
- store/hook/service：<粘贴>
- Toast/Modal/下载封装：<粘贴>
请输出 patch plan：
1. 按步骤说明要在哪些文件插入/修改逻辑
2. 复用哪些已有封装，禁止重复造轮子
3. 如果需要新增 helper/hook，阐述现有抽象为何不足
```

## 3. 生成 patch（逐步）
```text
针对 Step <编号>，输出：
- 目标：<一句话>
- diff（unified diff）
- 说明：使用的现有符号、副作用、潜在回归点
限制：只改与该 step 相关的文件，保持 diff <= 50 行。
```

## 4. 自测 / 回归
```text
生成两部分：
1. 功能验收：列出操作步骤 + 预期结果
2. 回归风险：老功能/各角色/布局影响，按风险降序
强调：权限、批量模式、loading/error 场景都要覆盖。
```

## 5. Commit / PR
```text
请给：
- Commit 拆分建议（UI / 逻辑 / 反馈 / 补测）
- PR title + summary
- Test Plan（引用自测）
- 风险与回滚策略
```
